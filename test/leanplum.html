<html>
<head>
  <script type="text/javascript" src="../dist/leanplum.min.js"></script>
  <script type="text/javascript" src="../bower_components/underscore/underscore-min.js"></script>
  <!--<script type="text/javascript" src="/static/js_sdk/leanplum.js"></script>-->
  <script>
    var REMOTE_APP_ID = "app_BWTRIgOs0OoevDfSsBtabRiGffu5wOFU3mkxIxA7NBs";
    var REMOTE_DEV_KEY = "dev_Bx8i3Bbz1OJBTBAu63NIifr3UwWqUBU5OhHtywo58RY";
    var REMOTE_PROD_KEY = "prod_A1c7DfHO6XTo2BRwzhkkXKFJ6oaPtoMnRA9xpPSlx74";
    var LOCAL_APP_ID = 's0xpw0vVarXZv8DFv2gQfaCcXGrRhISKMF0IYDc3fq0';
    var LOCAL_DEV_KEY = 'Hq6mbmzpmZ6NhiXVuxLw2x7S4TLy5CbWsHatVkeKoSY';
    var LOCAL_PROD_KEY = 'lZo8pb2E5tKB3SZYDmtLBGIRpWQFtDpRQRPLOcD1dt4';
    var STAGING_APP_ID = 'app_BWTRIgOs0OoevDfSsBtabRiGffu5wOFU3mkxIxA7NBs'; // 5865619656278016
    var STAGING_DEV_KEY = 'prod_A1c7DfHO6XTo2BRwzhkkXKFJ6oaPtoMnRA9xpPSlx74';
    var STAGING_PROD_KEY = 'dev_Bx8i3Bbz1OJBTBAu63NIifr3UwWqUBU5OhHtywo58RY';
    Leanplum.setAppIdForDevelopmentMode(REMOTE_APP_ID, REMOTE_DEV_KEY);
    //Leanplum.setAppIdForDevelopmentMode(LOCAL_APP_ID, LOCAL_DEV_KEY);
    // Leanplum.setAppIdForDevelopmentMode(STAGING_APP_ID, STAGING_DEV_KEY);
    //Leanplum.setAppIdForProductionMode(LOCAL_APP_ID, LOCAL_PROD_KEY);
    // Leanplum.setApiPath('http://leanplum-staging.appspot.com/api');
    // Leanplum.setSocketHost('dev-staging.leanplum.com');
    // Leanplum.setRequestBatching(false, 5);
    Leanplum.setVariables({"Price": 1, "gametables": {
      "90": [
      {
        "max": 1500,
        "level": 100,
        "name": "PenaltyBet",
        "min": 250
      },{
        "max": 4000,
        "level": 3,
        "min": 1500
      },{
        "max": 12000,
        "level": 7,
        "min": 4000
      },{
        "max": 48000,
        "level": 14,
        "min": 12000
      }
      ],
      "91": [
      {
        "max": 1500,
        "level": 0,
        "name": "HockeyBet",
        "min": 250
      },{
        "max": 4000,
        "level": 3,
        "min": 1500
      },{
        "max": 12000,
        "level": 7,
        "min": 4000
      },{
        "max": 48000,
        "level": 14,
        "min": 12000
      }
      ],
      "96": [
      {
        "max": 1500,
        "level": 0,
        "name": "BlackjackBet",
        "min": 0
      },{
        "max": 5000,
        "level": 5,
        "min": 0
      },{
        "max": 25000,
        "level": 10,
        "min": 0
      },{
        "max": 100000,
        "level": 15,
        "min": 0
      }
      ],
      "99": [
      {
        "max": 1560,
        "level": 0,
        "name": "SolitaireBet",
        "min": 520
      },{
        "max": 6240,
        "level": 3,
        "min": 1560
      },{
        "max": 24960,
        "level": 10,
        "min": 6240
      },{
        "max": 99840,
        "level": 20,
        "min": 24960
      },
      ],
      "100": [
      {
        "max": 1000,
        "level": 0,
        "name": "BingoBet",
        "min": 0
      },{
        "max": 5000,
        "level": 4,
        "min": 0
      },{
        "max": 15000,
        "level": 8,
        "min": 0
      },{
        "max": 50000,
        "level": 14,
        "min": 0
      },
      ]
    }
  });
    Leanplum.start();
    Leanplum.addVariablesChangedHandler(function() {
      var variables = Leanplum.getVariables();
      console.log(variables);
      _.each(_.keys(variables), function(varName) {
        console.log(varName, variables[varName], Leanplum.getVariable(varName));
        if (variables[varName] != Leanplum.getVariable(varName)) {
          console.log("ERROR: Mismatch");
        }
      });
    });
    Leanplum.addStartResponseHandler(function() {
      console.log("My variants:");
      console.log(Leanplum.getVariants());
    });
    Leanplum.track('test');
    setTimeout(function() {
      Leanplum.setUserAttributes('u1', {'Gender': 'Male', 'Age': 24});
    }, 15000);
    Leanplum.advanceTo('Level 1', undefined, {'coins': 100});
    
    window.onbeforeunload = function (e) {
      doUnlock();
    }
    function doUnlock() {
      if (navigator.appName == 'Microsoft Internet Explorer') {
        // works in IE (with an IFRAME)
        utilFrame.location.href = "/unlock.do?recordId=";
        console.log(1);
      } else if (navigator.appName == 'Netscape') {
        // None of this works....
        //window.location.href = "/unlock.do?recordId=" + recordId;
        var req = new XMLHttpRequest();
        console.log(1);
        req.open("GET", "localhost:8080/api?2", false); // false
        console.log(2);
        req.send();
        console.log(2);
      } else {
        // Works for chrome
        console.log(3);
        window.open("/unlock.do?recordId=");
      }
    }
    function track() {
      Leanplum.track('Clicks');
    }
    function pause() {
      Leanplum.pauseSession();
    }
  </script>
</head>
<body>
  <a href="javascript:track()">Track</a><br>
  <a href="javascript:pause()">Pause</a>
</body>
</html>
