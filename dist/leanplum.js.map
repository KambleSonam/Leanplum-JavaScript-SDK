{"version":3,"sources":["../src/leanplum.js"],"names":["exports","_","API_PATH","SOCKET_HOST","SDK_VERSION","CLIENT","NETWORK_TIMEOUT_SECONDS","METHODS","START","STOP","ADVANCE","TRACK","PAUSE_SESSION","RESUME_SESSION","PAUSE_STATE","RESUME_STATE","DOWNLOAD_FILE","MULTI","SET_VARS","GET_VARS","SET_USER_ATTRIBUTES","UPLOAD_FILE","REGISTER_DEVICE","PARAMS","ACTION","APP_ID","CLIENT_KEY","DEVICE_ID","USER_ID","NEW_USER_ID","DEV_MODE","VERSION_NAME","SYSTEM_NAME","SYSTEM_VERSION","BROWSER_NAME","BROWSER_VERSION","DEVICE_NAME","DEVICE_MODEL","USER_ATTRIBUTES","LOCALE","COUNTRY","REGION","CITY","LOCATION","STATE","INFO","EVENT","VALUE","FILENAME","TIME","DATA","VARS","FILE","SIZE","VARIATION","HASH","EMAIL","VARIABLES","INCLUDE_DEFAULTS","KEYS","IS_REGISTERED","LATEST_VERSION","VARIANTS","ACTION_METADATA","TOKEN","DEFAULT_KEYS","COUNT","ITEM","VALUES","DETECT","Leanplum","_checkForUpdatesInDevelopmentMode","_requestQueue","_variablesChangedHandlers","_variants","_startHandlers","_actionMetadata","_token","_batchEnabled","_batchCooldown","apiPath","isEmpty","email","_email","enabled","seconds","appId","accessKey","_appId","_clientKey","_devMode","host","deviceId","_deviceId","versionName","_versionName","deviceName","_deviceName","deviceModel","_deviceModel","systemName","_systemName","systemVersion","_systemVersion","variables","_variables","batchEnabled","cooldownSeconds","_merged","undefined","args","current","i","arguments","length","handler","push","_hasStarted","_startSuccessful","_hasReceivedDiffs","idx","indexOf","splice","userId","userAttributes","callback","_userId","request","ArgsBuilder","add","JSON","stringify","BrowserDetect","OS","browser","version","queued","sendNow","response","startResponse","_getLastResponse","_isResponseSuccess","latestVersion","console","log","WebSocket","_socketIOConnect","setContent","loadDiffs","client","SocketIOClient","authSent","onopen","emit","onerror","event","onmessage","getVarsResponse","values","variants","actionMetadata","isEqual","_diffs","sendVariables","alert","onclose","connect","setInterval","connected","connecting","_saveToLocalStorage","value","info","params","state","diffs","mergeHelper","saveDiffs","vars","diff","objIterator","obj","f","Array","attr","hasOwnProperty","call","varsIterator","diffIterator","isArray","charAt","varSubscript","substring","parseInt","merged","subscript","diffValue","body","parse","_getFromLocalStorage","e","_saveRequestForLater","count","itemKey","_popUnsentRequests","requestData","_removeFromLocalStorage","requestArgs","action","options","id","possible","Math","floor","random","argsBuilder","attachApiKeys","Date","getTime","success","error","err","_ajax","build","sendUnsentRequests","requestsToSend","multiRequestArgs","now","_lastRequestTime","_cooldownTimeout","setTimeout","buildDict","_numResponses","_getResponseAt","index","_getResponseError","_localStorageEnabled","_alternateLocalStorage","key","localStorage","removeItem","argString","argValues","prototype","encodeURIComponent","_body","name","socket","send","self","line","parts","split","session","heartbeat","heartbeatInterval","clearInterval","data","code","messageId","slice","join","close","_ajaxIE8","method","url","plainText","xdr","XDomainRequest","onload","ranCallback","responseText","_runningRequest","_dequeueRequest","ontimeout","onprogress","open","timeout","_enqueueRequest","shift","apply","location","protocol","handled","xhr","XMLHttpRequest","onreadystatechange","readyState","status","setRequestHeader","abort","iextend","each","source","prop","isFunction","has","eq","a","b","aStack","bStack","_wrapped","className","Object","toString","String","global","multiline","ignoreCase","size","result","aCtor","constructor","bCtor","pop","init","searchString","dataBrowser","searchVersion","navigator","userAgent","appVersion","dataOS","dataString","string","dataProp","versionSearchString","versionSearch","identity","subString","parseFloat","vendor","window","opera","platform"],"mappings":"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","file":"leanplum.js","sourcesContent":["/**\n * @preserve Leanplum Javascript SDK v1.1.10.\n * Copyright 2016, Leanplum, Inc. All rights reserved.\n *\n * You may not distribute this source code without prior written permission\n * from Leanplum.\n */\n(function() {\n  let exports = {};\n  let _ = function() {};\n\n  if (!this['Leanplum']) {\n    this['Leanplum'] = exports;\n  }\n\n  let API_PATH = 'https://www.leanplum.com/api';\n  let SOCKET_HOST = 'dev.leanplum.com';\n  const SDK_VERSION = '1.1.10';\n  const CLIENT = 'js';\n  let NETWORK_TIMEOUT_SECONDS = 10;\n\n  const METHODS = {\n    START: 'start',\n    STOP: 'stop',\n    ADVANCE: 'advance',\n    TRACK: 'track',\n    PAUSE_SESSION: 'pauseSession',\n    RESUME_SESSION: 'resumeSession',\n    PAUSE_STATE: 'pauseState',\n    RESUME_STATE: 'resumeState',\n    DOWNLOAD_FILE: 'downloadFile',\n    MULTI: 'multi',\n    SET_VARS: 'setVars',\n    GET_VARS: 'getVars',\n    SET_USER_ATTRIBUTES: 'setUserAttributes',\n    UPLOAD_FILE: 'uploadFile',\n    REGISTER_DEVICE: 'registerDevice',\n  };\n\n  const PARAMS = {\n    ACTION: 'action',\n    APP_ID: 'appId',\n    CLIENT: 'client',\n    CLIENT_KEY: 'clientKey',\n    DEVICE_ID: 'deviceId',\n    SDK_VERSION: 'sdkVersion',\n    USER_ID: 'userId',\n    NEW_USER_ID: 'newUserId',\n    DEV_MODE: 'devMode',\n    VERSION_NAME: 'versionName',\n    SYSTEM_NAME: 'systemName',\n    SYSTEM_VERSION: 'systemVersion',\n    BROWSER_NAME: 'browserName',\n    BROWSER_VERSION: 'browserVersion',\n    DEVICE_NAME: 'deviceName',\n    DEVICE_MODEL: 'deviceModel',\n    USER_ATTRIBUTES: 'userAttributes',\n    LOCALE: 'locale',\n    COUNTRY: 'country',\n    REGION: 'region',\n    CITY: 'city',\n    LOCATION: 'location',\n    STATE: 'state',\n    INFO: 'info',\n    EVENT: 'event',\n    VALUE: 'value',\n    FILENAME: 'filename',\n    TIME: 'time',\n    DATA: 'data',\n    VARS: 'vars',\n    FILE: 'file',\n    SIZE: 'size',\n    VARIATION: 'variation',\n    HASH: 'hash',\n    EMAIL: 'email',\n    VARIABLES: 'vars',\n    PARAMS: 'params',\n    INCLUDE_DEFAULTS: 'includeDefaults',\n  };\n\n  const KEYS = {\n    IS_REGISTERED: 'isRegistered',\n    LATEST_VERSION: 'latestVersion',\n    VARS: 'vars',\n    VARIANTS: 'variants',\n    ACTION_METADATA: 'actionMetadata',\n    TOKEN: 'token',\n  };\n\n  const DEFAULT_KEYS = {\n    COUNT: '__leanplum_unsynced',\n    ITEM: '__leanplum_unsynced_',\n    VARIABLES: '__leanplum_variables',\n    VARIANTS: '__leanplum_variants',\n    ACTION_METADATA: '__leanplum_action_metadata',\n    TOKEN: '__leanplum_token',\n    DEVICE_ID: '__leanplum_device_id',\n    USER_ID: '__leanplum_user_id',\n  };\n\n  const VALUES = {\n    DETECT: '(detect)',\n  };\n\n  let Leanplum = {\n    _checkForUpdatesInDevelopmentMode: true,\n    _requestQueue: [],\n    _variablesChangedHandlers: [],\n    _variants: [],\n    _startHandlers: [],\n    _actionMetadata: {},\n    _token: '',\n    _batchEnabled: true,\n    _batchCooldown: 5,\n  };\n\n  exports['setApiPath'] = function(apiPath) {\n    if (!apiPath || apiPath.isEmpty()) {\n      return;\n    }\n    API_PATH = apiPath;\n  };\n\n  exports['setEmail'] = function(email) {\n    Leanplum._email = email;\n  };\n\n  exports['setUpdateCheckingEnabledInDevelopmentMode'] = function(enabled) {\n    Leanplum._checkForUpdatesInDevelopmentMode = enabled;\n  };\n\n  exports['setNetworkTimeout'] = function(seconds) {\n    NETWORK_TIMEOUT_SECONDS = seconds;\n  };\n\n  exports['setAppIdForDevelopmentMode'] = function(appId, accessKey) {\n    Leanplum._appId = appId;\n    Leanplum._clientKey = accessKey;\n    Leanplum._devMode = true;\n  };\n\n  exports['setAppIdForProductionMode'] = function(appId, accessKey) {\n    Leanplum._appId = appId;\n    Leanplum._clientKey = accessKey;\n    Leanplum._devMode = false;\n  };\n\n  exports['setSocketHost'] = function(host) {\n    SOCKET_HOST = host;\n  };\n\n  exports['setDeviceId'] = function(deviceId) {\n    Leanplum._deviceId = deviceId;\n  };\n\n  exports['setAppVersion'] = function(versionName) {\n    Leanplum._versionName = versionName;\n  };\n\n  exports['setDeviceName'] = function(deviceName) {\n    Leanplum._deviceName = deviceName;\n  };\n\n  exports['setDeviceModel'] = function(deviceModel) {\n    Leanplum._deviceModel = deviceModel;\n  };\n\n  exports['setSystemName'] = function(systemName) {\n    Leanplum._systemName = systemName;\n  };\n\n  exports['setSystemVersion'] = function(systemVersion) {\n    Leanplum._systemVersion = systemVersion;\n  };\n\n  exports['setVariables'] = function(variables) {\n    Leanplum._variables = variables;\n  };\n\n  exports['setRequestBatching'] = function(batchEnabled, cooldownSeconds) {\n    Leanplum._batchEnabled = batchEnabled;\n    Leanplum._batchCooldown = cooldownSeconds;\n  };\n\n  exports['getVariables'] = function(variables) {\n    return Leanplum._merged !== undefined ? Leanplum._merged :\n      Leanplum._variables;\n  };\n\n  exports['getVariable'] = function(args) {\n    let current = exports['getVariables']();\n    for (let i = 0; i < arguments.length; i++) {\n      current = current[arguments.i];\n    }\n    return current;\n  };\n\n  exports['getVariants'] = function() {\n    return Leanplum._variants || [];\n  };\n\n  exports['addStartResponseHandler'] = function(handler) {\n    Leanplum._startHandlers.push(handler);\n    if (Leanplum._hasStarted) {\n      handler(Leanplum._startSuccessful);\n    }\n  };\n\n  exports['addVariablesChangedHandler'] = function(handler) {\n    Leanplum._variablesChangedHandlers.push(handler);\n    if (Leanplum._hasReceivedDiffs) {\n      handler();\n    }\n  };\n\n  exports['removeStartResponseHandler'] = function(handler) {\n    let idx = Leanplum._startHandlers.indexOf(handler);\n    if (idx >= 0) {\n      Leanplum._startHandlers.splice(idx, 1);\n    }\n  };\n\n  exports['removeVariablesChangedHandler'] = function(handler) {\n    let idx = Leanplum._variablesChangedHandlers.indexOf(handler);\n    if (idx >= 0) {\n      Leanplum._variablesChangedHandlers.splice(idx, 1);\n    }\n  };\n\n  exports['start'] = function(userId, userAttributes, callback) {\n    // Overloads.\n    if (typeof(userId) == 'function') {\n      callback = userId;\n      userAttributes = {};\n      userId = null;\n    } else if (typeof(userId) == 'object' && userId !== null &&\n      userId !== undefined) {\n      callback = userAttributes;\n      userAttributes = userId;\n      userId = null;\n    } else if (typeof(userAttributes) == 'function') {\n      callback = userAttributes;\n      userAttributes = {};\n    }\n    Leanplum._userId = userId;\n    if (callback) {\n      exports['addStartResponseHandler'](callback);\n    }\n\n    // Issue request.\n    Leanplum.request(METHODS.START,\n      new ArgsBuilder()\n      .add(PARAMS.USER_ATTRIBUTES, JSON.stringify(userAttributes))\n      .add(PARAMS.COUNTRY, VALUES.DETECT)\n      .add(PARAMS.REGION, VALUES.DETECT)\n      .add(PARAMS.CITY, VALUES.DETECT)\n      .add(PARAMS.LOCATION, VALUES.DETECT)\n      .add(PARAMS.SYSTEM_NAME, Leanplum._systemName || BrowserDetect.OS)\n      .add(PARAMS.SYSTEM_VERSION, '' + (Leanplum._systemVersion || ''))\n      .add(PARAMS.BROWSER_NAME, BrowserDetect.browser)\n      .add(PARAMS.BROWSER_VERSION, '' + BrowserDetect.version)\n      .add(PARAMS.LOCALE, VALUES.DETECT)\n      .add(PARAMS.DEVICE_NAME, Leanplum._deviceName || (BrowserDetect.browser +\n        ' ' + BrowserDetect.version))\n      .add(PARAMS.DEVICE_MODEL, Leanplum._deviceModel || 'Web Browser')\n      .add(PARAMS.INCLUDE_DEFAULTS, false)\n      // TODO: referer\n      , {\n        queued: true,\n        sendNow: true,\n        response: function(response) {\n          Leanplum._hasStarted = true;\n          let startResponse = Leanplum._getLastResponse(response);\n          if (Leanplum._isResponseSuccess(startResponse)) {\n            Leanplum._startSuccessful = true;\n\n            if (Leanplum._devMode) {\n              let latestVersion = startResponse[KEYS.LATEST_VERSION];\n              if (latestVersion) {\n                console.log('A newer version of Leanplum, ' + latestVersion +\n                  ', is available. ' + 'Go to leanplum.com to download it.');\n              }\n              if (WebSocket) {\n                Leanplum._socketIOConnect();\n              } else {\n                console.log('Your browser doesn\\'t support WebSockets.');\n              }\n            }\n\n            Leanplum.setContent(\n              startResponse[KEYS.VARS],\n              startResponse[KEYS.VARIANTS],\n              startResponse[KEYS.ACTION_METADATA]);\n            Leanplum._token = startResponse[KEYS.TOKEN];\n          } else {\n            Leanplum._startSuccessful = false;\n            Leanplum.loadDiffs();\n          }\n          for (let i = 0; i < Leanplum._startHandlers.length; i++) {\n            Leanplum._startHandlers[i](Leanplum._startSuccessful);\n          }\n        },\n      }\n    );\n  };\n\n  exports['startFromCache'] = function(userId, userAttributes, callback) {\n    // Overloads.\n    if (typeof(userId) == 'function') {\n      callback = userId;\n      userAttributes = {};\n      userId = null;\n    } else if (typeof(userId) == 'object' && userId !== null &&\n      userId !== undefined) {\n      callback = userAttributes;\n      userAttributes = userId;\n      userId = null;\n    } else if (typeof(userAttributes) == 'function') {\n      callback = userAttributes;\n      userAttributes = {};\n    }\n    Leanplum._userId = userId;\n    if (callback) {\n      exports['addStartResponseHandler'](callback);\n    }\n\n    Leanplum._hasStarted = true;\n    Leanplum._startSuccessful = true;\n    if (Leanplum._devMode) {\n      if (WebSocket) {\n        Leanplum._socketIOConnect();\n      } else {\n        console.log('Your browser doesn\\'t support WebSockets.');\n      }\n    }\n    Leanplum.loadDiffs();\n    for (let i = 0; i < Leanplum._startHandlers.length; i++) {\n      Leanplum._startHandlers[i](Leanplum._startSuccessful);\n    }\n  };\n\n  Leanplum._socketIOConnect = function() {\n    let client = new SocketIOClient();\n    let authSent = false;\n    client.onopen = function() {\n      if (!authSent) {\n        console.log('Leanplum: Connected to development server.');\n        let args = {};\n        args[PARAMS.APP_ID] = Leanplum._appId;\n        args[PARAMS.DEVICE_ID] = Leanplum._deviceId;\n        client.emit('auth', args);\n        authSent = true;\n      }\n    };\n    client.onerror = function(event) {\n      console.log('Leanplum: Socket error', event);\n    };\n    client.onmessage = function(event, args) {\n      if (event == 'updateVars') {\n        Leanplum.request(METHODS.GET_VARS,\n          new ArgsBuilder()\n          .add(PARAMS.INCLUDE_DEFAULTS, false), {\n            queued: false,\n            sendNow: true,\n            response: function(response) {\n              let getVarsResponse = Leanplum._getLastResponse(response);\n              let values = getVarsResponse[KEYS.VARS];\n              let variants = getVarsResponse[KEYS.VARIANTS];\n              let actionMetadata = getVarsResponse[KEYS.ACTION_METADATA];\n              if (!_.isEqual(values, Leanplum._diffs)) {\n                Leanplum.setContent(values, variants, actionMetadata);\n              }\n            },\n          }\n        );\n      } else if (event == 'getVariables') {\n        Leanplum.sendVariables();\n        client.emit('getContentResponse', {\n          'updated': true,\n        });\n      } else if (event == 'getActions') {\n        // Unsupported in JavaScript SDK.\n        client.emit('getContentResponse', {\n          'updated': false,\n        });\n      } else if (event == 'registerDevice') {\n        alert('Your device has been registered to ' + args[0]['email'] + '.');\n      }\n    };\n    client.onclose = function() {\n      console.log('Leanplum: Disconnected to development server.');\n      authSent = false;\n    };\n    client.connect();\n    setInterval(function() {\n      if (!client.connected && !client.connecting) {\n        client.connect();\n      }\n    }, 5000);\n  };\n\n  exports['stop'] = function() {\n    Leanplum.request(METHODS.STOP, undefined, {\n      sendNow: true,\n      queued: true,\n    });\n  };\n\n  exports['pauseSession'] = function() {\n    Leanplum.request(METHODS.PAUSE_SESSION, undefined, {\n      sendNow: true,\n      queued: true,\n    });\n  };\n\n  exports['resumeSession'] = function() {\n    Leanplum.request(METHODS.RESUME_SESSION, undefined, {\n      sendNow: true,\n      queued: true,\n    });\n  };\n\n  exports['pauseState'] = function() {\n    Leanplum.request(METHODS.PAUSE_STATE, undefined, {\n      queued: true,\n    });\n  };\n\n  exports['resumeState'] = function() {\n    Leanplum.request(METHODS.RESUME_STATE, undefined, {\n      queued: true,\n    });\n  };\n\n  exports['setUserId'] = function(userId) {\n      exports['setUserAttributes'](userId);\n    },\n\n    exports['setUserAttributes'] = function(userId, userAttributes) {\n      if (userAttributes === undefined) {\n        if (typeof userId == 'object') {\n          userAttributes = userId;\n          userId = undefined;\n        } else if (typeof userId != 'string') {\n          console.log('Leanplum: setUserAttributes expects a string or an ' +\n            'object');\n          return;\n        }\n      }\n      Leanplum.request(METHODS.SET_USER_ATTRIBUTES,\n        new ArgsBuilder()\n        .add(PARAMS.USER_ATTRIBUTES,\n          userAttributes ? JSON.stringify(userAttributes) : undefined)\n        .add(PARAMS.NEW_USER_ID, userId), {\n          queued: true,\n        });\n      if (userId) {\n        Leanplum._userId = userId;\n        Leanplum._saveToLocalStorage(DEFAULT_KEYS.USER_ID, Leanplum._userId);\n      }\n    };\n\n  exports['track'] = function(event, value, info, params) {\n    // Overloads.\n    // object && !null && !undefined -> params\n    // string -> info, params\n    // *, object && !null && !undefined -> value, params\n    if (typeof(value) == 'object' && value !== null && value !== undefined) {\n      params = value;\n      info = undefined;\n      value = undefined;\n    } else if (typeof(value) == 'string') {\n      params = info;\n      info = value;\n      value = undefined;\n    } else if (typeof(info) == 'object' && info !== null &&\n      info !== undefined) {\n      params = info;\n      info = undefined;\n    }\n\n    Leanplum.request(METHODS.TRACK,\n      new ArgsBuilder()\n      .add(PARAMS.EVENT, event)\n      .add(PARAMS.VALUE, value || 0.0)\n      .add(PARAMS.INFO, info)\n      .add(PARAMS.PARAMS, JSON.stringify(params)), {\n        queued: true,\n      });\n  };\n\n  exports['advanceTo'] = function(state, info, params) {\n    // Overloads.\n    // string|null|undefined, * -> info, params\n    // object && !null && !undefined -> params\n    if (typeof(info) == 'object' && info !== null && info !== undefined) {\n      params = info;\n      info = undefined;\n    }\n\n    Leanplum.request(METHODS.ADVANCE,\n      new ArgsBuilder()\n      .add(PARAMS.STATE, state)\n      .add(PARAMS.INFO, info)\n      .add(PARAMS.PARAMS, JSON.stringify(params)), {\n        queued: true,\n      });\n  };\n\n  // Leanplum utility methods.\n\n  Leanplum.setContent = function(diffs, variants, actionMetadata) {\n    Leanplum._diffs = diffs;\n    Leanplum._variants = variants;\n    Leanplum._actionMetadata = actionMetadata;\n    Leanplum._hasReceivedDiffs = true;\n    Leanplum._merged = Leanplum.mergeHelper(Leanplum._variables, diffs);\n    Leanplum.saveDiffs();\n    for (let i = 0; i < Leanplum._variablesChangedHandlers.length; i++) {\n      Leanplum._variablesChangedHandlers[i]();\n    }\n  };\n\n  Leanplum.mergeHelper = function(vars, diff) {\n    if (typeof diff == 'number' || typeof diff == 'boolean' ||\n      typeof diff == 'string') {\n      return diff;\n    }\n    if (diff === null || diff === undefined) {\n      return vars;\n    }\n\n    let objIterator = function(obj) {\n      return function(f) {\n        if (obj instanceof Array) {\n          for (let i = 0; i < obj.length; i++) {\n            f(obj[i]);\n          }\n        } else {\n          for (let attr in obj) {\n            if ({}.hasOwnProperty.call(obj, attr)) {\n              f(attr);\n            }\n          }\n        }\n      };\n    };\n    let varsIterator = objIterator(vars);\n    let diffIterator = objIterator(diff);\n\n    // Infer that the diffs is an array if the vars value doesn't exist to tell\n    // us the type.\n    let isArray = false;\n    if (vars == null) {\n      if (!(diff instanceof Array)) {\n        isArray = null;\n        for (let attr in diff) {\n          if (isArray === null) {\n            isArray = true;\n          }\n          if (!(typeof attr == 'string')) {\n            isArray = false;\n            break;\n          }\n          if (attr.length < 3 || attr.charAt(0) != '[' ||\n            attr.charAt(attr.length - 1) != ']') {\n            isArray = false;\n            break;\n          }\n          let varSubscript = attr.substring(1, attr.length - 1);\n          if (!('' + parseInt(varSubscript)) == varSubscript) {\n            isArray = false;\n            break;\n          }\n        }\n      }\n    }\n\n    // Merge arrays.\n    if (vars instanceof Array || isArray) {\n      let merged = [];\n      varsIterator(function(attr) {\n        merged.push(attr);\n      });\n      diffIterator(function(varSubscript) {\n        let subscript =\n          parseInt(varSubscript.substring(1, varSubscript.length - 1));\n        let diffValue = diff[varSubscript];\n        while (subscript >= merged.length) {\n          merged.push(null);\n        }\n        merged[subscript] = Leanplum.mergeHelper(merged[subscript], diffValue);\n      });\n      return merged;\n    }\n\n    // Merge dictionaries.\n    let merged = {};\n    varsIterator(function(attr) {\n      if (diff[attr] === null || diff[attr] === undefined) {\n        merged[attr] = vars[attr];\n      }\n    });\n    diffIterator(function(attr) {\n      merged[attr] = Leanplum.mergeHelper(vars != null ? vars[attr] : null,\n        diff[attr]);\n    });\n    return merged;\n  };\n\n  Leanplum.sendVariables = function() {\n    let body = {};\n    body[PARAMS.VARIABLES] = Leanplum._variables;\n    Leanplum.request(METHODS.SET_VARS,\n      new ArgsBuilder().body(JSON.stringify(body)), {\n        sendNow: true,\n      });\n  };\n\n  Leanplum.loadDiffs = function() {\n    try {\n      Leanplum.setContent(\n        JSON.parse(Leanplum._getFromLocalStorage(\n          DEFAULT_KEYS.VARIABLES) || null),\n        JSON.parse(Leanplum._getFromLocalStorage(\n          DEFAULT_KEYS.VARIANTS) || null),\n        JSON.parse(Leanplum._getFromLocalStorage(\n          DEFAULT_KEYS.ACTION_METADATA) || null));\n      Leanplum._token = Leanplum._getFromLocalStorage(DEFAULT_KEYS.TOKEN);\n    } catch (e) {\n      console.log('Leanplum: Invalid diffs: ' + e);\n    }\n  };\n\n  Leanplum.saveDiffs = function() {\n    Leanplum._saveToLocalStorage(\n      DEFAULT_KEYS.VARIABLES, JSON.stringify(Leanplum._diffs || {}));\n    Leanplum._saveToLocalStorage(\n      DEFAULT_KEYS.VARIANTS, JSON.stringify(Leanplum._variants || [])\n    );\n    Leanplum._saveToLocalStorage(DEFAULT_KEYS.ACTION_METADATA,\n      JSON.stringify(Leanplum._actionMetadata || {}));\n    Leanplum._saveToLocalStorage(DEFAULT_KEYS.TOKEN, Leanplum._token);\n  };\n\n  Leanplum._saveRequestForLater = function(args) {\n    let count = Leanplum._getFromLocalStorage(DEFAULT_KEYS.COUNT) || 0;\n    let itemKey = DEFAULT_KEYS.ITEM + count;\n    Leanplum._saveToLocalStorage(itemKey, JSON.stringify(args));\n    count++;\n    Leanplum._saveToLocalStorage(DEFAULT_KEYS.COUNT, count);\n  };\n\n  Leanplum._popUnsentRequests = function() {\n    let requestData = [];\n    let count = Leanplum._getFromLocalStorage(DEFAULT_KEYS.COUNT) || 0;\n    Leanplum._removeFromLocalStorage(DEFAULT_KEYS.COUNT);\n    for (let i = 0; i < count; i++) {\n      let itemKey = DEFAULT_KEYS.ITEM + i;\n      try {\n        let requestArgs = JSON.parse(Leanplum._getFromLocalStorage(itemKey));\n        requestData.push(requestArgs);\n      } catch (e) {}\n      Leanplum._removeFromLocalStorage(itemKey);\n    }\n    return requestData;\n  };\n\n  Leanplum.request = function(action, params, options) {\n    options = options || {};\n    params = params || new ArgsBuilder();\n\n    // Get or create device ID and user ID.\n    if (!Leanplum._deviceId) {\n      Leanplum._deviceId =\n        Leanplum._getFromLocalStorage(DEFAULT_KEYS.DEVICE_ID);\n    }\n    if (!Leanplum._deviceId) {\n      let id = '';\n      let possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz' +\n        '0123456789';\n      for (let i = 0; i < 16; i++) {\n        id += possible.charAt(Math.floor(Math.random() * possible.length));\n      }\n      Leanplum._deviceId = id;\n      Leanplum._saveToLocalStorage(DEFAULT_KEYS.DEVICE_ID, id);\n    }\n    if (!Leanplum._userId) {\n      Leanplum._userId = Leanplum._getFromLocalStorage(DEFAULT_KEYS.USER_ID);\n      if (!Leanplum._userId) {\n        Leanplum._userId = Leanplum._deviceId;\n      }\n    }\n    Leanplum._saveToLocalStorage(DEFAULT_KEYS.USER_ID, Leanplum._userId);\n\n    let argsBuilder = params\n      .attachApiKeys()\n      .add(PARAMS.SDK_VERSION, SDK_VERSION)\n      .add(PARAMS.DEVICE_ID, Leanplum._deviceId)\n      .add(PARAMS.USER_ID, Leanplum._userId)\n      .add(PARAMS.ACTION, action)\n      .add(PARAMS.VERSION_NAME, Leanplum._versionName)\n      .add(PARAMS.DEV_MODE, Leanplum._devMode)\n      .add(PARAMS.TIME, '' + (new Date().getTime() / 1000));\n    let success = options.success || options.response;\n    let error = options.error || options.response;\n\n    if (!Leanplum._appId || !Leanplum._clientKey) {\n      let err = 'Leanplum App ID and client key are not set. Make sure you ' +\n        'are calling setAppIdForDevelopmentMode or setAppIdForProductionMode ' +\n        'before issuing API calls.';\n      console.error(err);\n      if (error) error(err);\n      return;\n    }\n\n    if (params.body()) {\n      Leanplum._ajax('POST', API_PATH + '?' + argsBuilder.build(),\n        params.body(), success, error, options.queued);\n      return;\n    }\n\n    let sendNow = (Leanplum._devMode || options.sendNow ||\n      !Leanplum._batchEnabled);\n\n    let sendUnsentRequests = function() {\n      let requestsToSend = Leanplum._popUnsentRequests();\n      if (requestsToSend.length > 0) {\n        let requestData = JSON.stringify({\n          'data': requestsToSend,\n        });\n        let multiRequestArgs = new ArgsBuilder()\n          .attachApiKeys()\n          .add(PARAMS.SDK_VERSION, SDK_VERSION)\n          .add(PARAMS.ACTION, METHODS.MULTI)\n          .add(PARAMS.TIME, '' + (new Date().getTime() / 1000))\n          .build();\n        Leanplum._ajax('POST', API_PATH + '?' + multiRequestArgs, requestData,\n          success, error, options.queued);\n      }\n    };\n\n    // Deal with cooldown.\n    if (!sendNow && Leanplum._batchCooldown) {\n      let now = new Date().getTime() / 1000;\n      if (!Leanplum._lastRequestTime ||\n        now - Leanplum._lastRequestTime >= Leanplum._batchCooldown) {\n        sendNow = true;\n        Leanplum._lastRequestTime = now;\n      } else {\n        if (!Leanplum._cooldownTimeout) {\n          Leanplum._cooldownTimeout = setTimeout(function() {\n            Leanplum._cooldownTimeout = null;\n            Leanplum._lastRequestTime = new Date().getTime() / 1000;\n            sendUnsentRequests();\n          }, (Leanplum._batchCooldown -\n            (now - Leanplum._lastRequestTime)) * 1000);\n        }\n      }\n    }\n\n    Leanplum._saveRequestForLater(argsBuilder.buildDict());\n    if (sendNow) {\n      sendUnsentRequests();\n    }\n  };\n\n  // //////////////// Response parsing //////////////////\n\n  Leanplum._numResponses = function(response) {\n    if (!response || !response['response']) {\n      return 0;\n    }\n    return response['response'].length;\n  };\n\n  Leanplum._getResponseAt = function(response, index) {\n    if (!response || !response['response']) {\n      return null;\n    }\n    return response['response'][index];\n  };\n\n  Leanplum._getLastResponse = function(response) {\n    let count = Leanplum._numResponses(response);\n    if (count > 0) {\n      return Leanplum._getResponseAt(response, count - 1);\n    } else {\n      return null;\n    }\n  };\n\n  Leanplum._isResponseSuccess = function(response) {\n    if (!response) {\n      return false;\n    }\n    return response['success'] ? true : false;\n  };\n\n  Leanplum._getResponseError = function(response) {\n    if (!response) {\n      return null;\n    }\n    let error = response['error'];\n    if (!error) {\n      return null;\n    }\n    return error['message'];\n  };\n\n  Leanplum._localStorageEnabled = undefined;\n  Leanplum._alternateLocalStorage = {};\n\n  Leanplum._getFromLocalStorage = function(key) {\n    if (Leanplum._localStorageEnabled === false) {\n      return Leanplum._alternateLocalStorage[key];\n    }\n    return localStorage[key];\n  };\n\n  Leanplum._saveToLocalStorage = function(key, value) {\n    if (Leanplum._localStorageEnabled === false) {\n      Leanplum._alternateLocalStorage[key] = value;\n      return;\n    }\n    try {\n      localStorage[key] = value;\n    } catch (e) {\n      Leanplum._localStorageEnabled = false;\n      Leanplum._saveToLocalStorage(key, value);\n    }\n  };\n\n  Leanplum._removeFromLocalStorage = function(key) {\n    if (Leanplum._localStorageEnabled === false) {\n      delete Leanplum._alternateLocalStorage[key];\n      return;\n    }\n    try {\n      localStorage.removeItem(key);\n    } catch (e) {\n      Leanplum._localStorageEnabled = false;\n      Leanplum._removeFromLocalStorage(key);\n    }\n  };\n\n  // //////////////// Args builder //////////////////\n\n  let ArgsBuilder = function() {\n    this.argString = '';\n    this.argValues = {};\n  };\n  ArgsBuilder.prototype.add = function(key, value) {\n    if (typeof(value) === 'undefined') {\n      return this;\n    }\n    if (this.argString) {\n      this.argString += '&';\n    }\n    this.argString += key + '=' + encodeURIComponent(value);\n    this.argValues[key] = value;\n    return this;\n  };\n  ArgsBuilder.prototype.body = function(body) {\n    if (body) {\n      this._body = body;\n      return this;\n    }\n    return this._body;\n  };\n  ArgsBuilder.prototype.attachApiKeys = function(argsBuilder) {\n    return this.add(PARAMS.APP_ID, Leanplum._appId)\n      .add(PARAMS.CLIENT, CLIENT)\n      .add(PARAMS.CLIENT_KEY, Leanplum._clientKey);\n  };\n  ArgsBuilder.prototype.build = function() {\n    return this.argString;\n  };\n  ArgsBuilder.prototype.buildDict = function() {\n    return this.argValues;\n  };\n\n  // //////////////// Socket IO //////////////////\n\n  let SocketIOClient = function() {\n    this.connected = false;\n    this.connecting = false;\n  };\n  SocketIOClient.prototype.emit = function(name, args) {\n    this.socket.send('5:::' + JSON.stringify({\n      'name': name,\n      'args': args,\n    }));\n  };\n  SocketIOClient.prototype.connect = function() {\n    let self = this;\n    self.connecting = true;\n    Leanplum._ajax('POST', 'https://' + SOCKET_HOST + '/socket.io/1', '',\n      function(line) {\n        let parts = line.split(':');\n        let session = parts[0];\n        let heartbeat = parseInt(parts[1]) / 2 * 1000;\n        self.socket = new WebSocket('wss://' + SOCKET_HOST +\n          '/socket.io/1/websocket/' + session);\n        let heartbeatInterval = null;\n        self.socket.onopen = function() {\n          self.connected = true;\n          self.connecting = false;\n          if (self.onopen) {\n            self.onopen();\n          }\n          heartbeatInterval = setInterval(function() {\n            self.socket.send('2:::');\n          }, heartbeat);\n        };\n        self.socket.onclose = function() {\n          self.connected = false;\n          clearInterval(heartbeatInterval);\n          if (self.onclose) {\n            self.onclose();\n          }\n        };\n        self.socket.onmessage = function(event) {\n          let parts = event.data.split(':');\n          let code = parseInt(parts[0]);\n          if (code == 2) {\n            self.socket.send('2::');\n          } else if (code == 5) {\n            let messageId = parts[1];\n            let data = JSON.parse(parts.slice(3).join(':'));\n            let event = data['name'];\n            let args = data['args'];\n            if (messageId) {\n              self.socket.send('6:::' + messageId);\n            }\n            if (self.onmessage) {\n              self.onmessage(event, args);\n            }\n          } else if (code == 7) {\n            console.log('Socket error: ' + event.data);\n          }\n        };\n        self.socket.onerror = function(event) {\n          self.socket.close();\n          if (self.onerror) {\n            self.onerror(event);\n          }\n        };\n      }, null, false, true // nullm, queued, plainText\n    );\n  };\n\n  // //////////////// AJAX //////////////////\n\n  /*\n   * Ajax functions from:\n   *\n   * Parse JavaScript SDK\n   * Version: 1.1.5\n   * Built: Mon Oct 01 2012 17:57:13\n   * http://parse.com\n   *\n   * Copyright 2012 Parse, Inc.\n   * The Parse JavaScript SDK is freely distributable under the MIT license.\n   *\n   * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n   * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n   * DEALINGS IN THE SOFTWARE.\n   */\n  Leanplum._ajaxIE8 = function(method, url, data, success, error, queued,\n    plainText) {\n    let xdr = new XDomainRequest();\n    xdr.onload = function() {\n      let response;\n      let ranCallback = false;\n      if (plainText) {\n        response = xdr.responseText;\n      } else {\n        try {\n          response = JSON.parse(xdr.responseText);\n        } catch (e) {\n          setTimeout(function() {\n            if (error) {\n              error(null, xdr);\n            }\n          }, 0);\n          ranCallback = true;\n        }\n      }\n      if (!ranCallback) {\n        setTimeout(function() {\n          if (success) {\n            success(response, xdr);\n          }\n        }, 0);\n      }\n      if (queued) {\n        Leanplum._runningRequest = false;\n        Leanplum._dequeueRequest();\n      }\n    };\n    xdr.onerror = xdr.ontimeout = function() {\n      setTimeout(function() {\n        if (error) {\n          error(null, xdr);\n        }\n      }, 0);\n      if (queued) {\n        Leanplum._runningRequest = false;\n        Leanplum._dequeueRequest();\n      }\n    };\n    xdr.onprogress = function() {};\n    xdr.open(method, url);\n    xdr.timeout = NETWORK_TIMEOUT_SECONDS * 1000;\n    xdr.send(data);\n  };\n\n  Leanplum._enqueueRequest = function(args) {\n    Leanplum._requestQueue.push(args);\n  };\n\n  Leanplum._dequeueRequest = function() {\n    let args = Leanplum._requestQueue.shift();\n    if (args) {\n      Leanplum._ajax.apply(null, args);\n    }\n  };\n\n  Leanplum._ajax = function(method, url, data, success, error, queued,\n    plainText) {\n    if (queued) {\n      if (Leanplum._runningRequest) {\n        // eslint-disable-next-line prefer-rest-params\n        return Leanplum._enqueueRequest(arguments);\n      }\n      Leanplum._runningRequest = true;\n    }\n\n    if (typeof(XDomainRequest) !== 'undefined') {\n      if (location.protocol === 'http:' && url.indexOf('https:') == 0) {\n        url = 'http:' + url.substring(6);\n      }\n      // eslint-disable-next-line prefer-rest-params\n      return Leanplum._ajaxIE8.apply(null, arguments);\n    }\n\n    let handled = false;\n\n    let xhr = new XMLHttpRequest();\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState === 4) {\n        if (handled) {\n          return;\n        }\n        handled = true;\n\n        let response;\n        let ranCallback = false;\n        if (plainText) {\n          response = xhr.responseText;\n        } else {\n          try {\n            response = JSON.parse(xhr.responseText);\n          } catch (e) {\n            setTimeout(function() {\n              if (error) {\n                error(null, xhr);\n              }\n            }, 0);\n            ranCallback = true;\n          }\n        }\n\n        if (!ranCallback) {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            setTimeout(function() {\n              if (success) {\n                success(response, xhr);\n              }\n            }, 0);\n          } else {\n            setTimeout(function() {\n              if (error) {\n                error(response, xhr);\n              }\n            }, 0);\n          }\n        }\n\n        if (queued) {\n          Leanplum._runningRequest = false;\n          Leanplum._dequeueRequest();\n        }\n      }\n    };\n    xhr.open(method, url, true);\n    xhr.setRequestHeader('Content-Type', 'text/plain'); // Avoid pre-flight.\n    xhr.send(data);\n    setTimeout(function() {\n      if (!handled) {\n        xhr.abort();\n      }\n    }, NETWORK_TIMEOUT_SECONDS * 1000);\n  };\n\n  //     Underscore.js 1.4.2\n  //     http://underscorejs.org\n  //     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.\n  //     Underscore may be freely distributed under the MIT license.\n\n  // Extend a given object with all the properties in passed-in object(s).\n  _.iextend = function(obj) {\n    // eslint-disable-next-line prefer-rest-params\n    each(slice.call(arguments, 1), function(source) {\n      for (let prop in source) {\n        if ({}.hasOwnProperty.call(source, prop)) {\n          obj[prop] = source[prop];\n        }\n      }\n    });\n    return obj;\n  };\n\n  _.isFunction = function(obj) {\n    return typeof obj === 'function';\n  };\n\n  _.has = function(obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  // Internal recursive comparison function for `isEqual`.\n  let eq = function(a, b, aStack, bStack) {\n    // Identical objects are equal. `0 === -0`, but they aren't identical.\n    // See the Harmony `egal` proposal:\n    // http://wiki.ecmascript.org/doku.php?id=harmony:egal.\n    if (a === b) return a !== 0 || 1 / a == 1 / b;\n    // A strict comparison is necessary because `null == undefined`.\n    if (a == null || b == null) return a === b;\n    // Unwrap any wrapped objects.\n    if (a instanceof _) a = a._wrapped;\n    if (b instanceof _) b = b._wrapped;\n    // Compare `[[Class]]` names.\n    let className = Object.prototype.toString.call(a);\n    if (className != Object.prototype.toString.call(b)) return false;\n    switch (className) {\n      // Strings, numbers, dates, and booleans are compared by value.\n      case '[object String]':\n        // Primitives and their corresponding object wrappers are equivalent;\n        // thus, `\"5\"` is equivalent to `new String(\"5\")`.\n        return a == String(b);\n      case '[object Number]':\n        // `NaN`s are equivalent, but non-reflexive. An `egal` comparison is\n        // performed for other numeric values.\n        return a != +a ? b != +b : (a == 0 ? 1 / a == 1 / b : a == +b);\n      case '[object Date]':\n      case '[object Boolean]':\n        // Coerce dates and booleans to numeric primitive values. Dates are\n        // compared by their millisecond representations. Note that invalid\n        // dates with millisecond representations of `NaN` are not equivalent.\n        return +a == +b;\n        // RegExps are compared by their source patterns and flags.\n      case '[object RegExp]':\n        return a.source == b.source &&\n          a.global == b.global &&\n          a.multiline == b.multiline &&\n          a.ignoreCase == b.ignoreCase;\n    }\n    if (typeof a != 'object' || typeof b != 'object') return false;\n    // Assume equality for cyclic structures. The algorithm for detecting cyclic\n    // structures is adapted from ES 5.1 section 15.12.3, abstract operation\n    // `JO`.\n    let length = aStack.length;\n    while (length--) {\n      // Linear search. Performance is inversely proportional to the number of\n      // unique nested structures.\n      if (aStack[length] == a) return bStack[length] == b;\n    }\n    // Add the first object to the stack of traversed objects.\n    aStack.push(a);\n    bStack.push(b);\n    let size = 0;\n    let result = true;\n    // Recursively compare objects and arrays.\n    if (className == '[object Array]') {\n      // Compare array lengths to determine if a deep comparison is necessary.\n      size = a.length;\n      result = size == b.length;\n      if (result) {\n        // Deep compare the contents, ignoring non-numeric properties.\n        while (size--) {\n          if (!(result = eq(a[size], b[size], aStack, bStack))) break;\n        }\n      }\n    } else {\n      // Objects with different constructors are not equivalent, but `Object`s\n      // from different frames are.\n      let aCtor = a.constructor;\n      let bCtor = b.constructor;\n      if (aCtor !== bCtor && !(_.isFunction(aCtor) &&\n          (aCtor instanceof aCtor) && _.isFunction(bCtor) &&\n          (bCtor instanceof bCtor))) {\n        return false;\n      }\n      // Deep compare objects.\n      for (let key in a) {\n        if (_.has(a, key)) {\n          // Count the expected number of properties.\n          size++;\n          // Deep compare each member.\n          if (!(result = _.has(b, key) && eq(a[key], b[key], aStack, bStack))) {\n            break;\n          }\n        }\n      }\n      // Ensure that both objects contain the same number of properties.\n      if (result) {\n        for (key in b) {\n          if (_.has(b, key) && !(size--)) break;\n        }\n        result = !size;\n      }\n    }\n    // Remove the first object from the stack of traversed objects.\n    aStack.pop();\n    bStack.pop();\n    return result;\n  };\n\n  // Perform a deep comparison to check if two objects are equal.\n  _.isEqual = function(a, b) {\n    return eq(a, b, [], []);\n  };\n\n  // Browser detection. Source: http://www.quirksmode.org/js/detect.html\n  let BrowserDetect = {\n    init: function() {\n      this.browser = this.searchString(this.dataBrowser) ||\n        'An unknown browser';\n      this.version = this.searchVersion(navigator.userAgent) ||\n        this.searchVersion(navigator.appVersion) || 'an unknown version';\n      this.OS = this.searchString(this.dataOS) || 'an unknown OS';\n    },\n    searchString: function(data) {\n      for (let i = 0; i < data.length; i++) {\n        let dataString = data[i].string;\n        let dataProp = data[i].prop;\n        this.versionSearchString = data[i].versionSearch || data[i].identity;\n        if (dataString) {\n          if (dataString.indexOf(data[i].subString) != -1)\n            return data[i].identity;\n        } else if (dataProp)\n          return data[i].identity;\n      }\n    },\n    searchVersion: function(dataString) {\n      if (!dataString) {\n        return;\n      }\n      let index = dataString.indexOf(this.versionSearchString);\n      if (index == -1) {\n        return;\n      }\n      return parseFloat(dataString.substring(index +\n        this.versionSearchString.length + 1));\n    },\n    dataBrowser: [{\n      string: navigator.userAgent,\n      subString: 'Chrome',\n      identity: 'Chrome',\n    }, {\n      string: navigator.userAgent,\n      subString: 'OmniWeb',\n      versionSearch: 'OmniWeb/',\n      identity: 'OmniWeb',\n    }, {\n      string: navigator.vendor,\n      subString: 'Apple',\n      identity: 'Safari',\n      versionSearch: 'Version',\n    }, {\n      prop: window.opera,\n      identity: 'Opera',\n      versionSearch: 'Version',\n    }, {\n      string: navigator.vendor,\n      subString: 'iCab',\n      identity: 'iCab',\n    }, {\n      string: navigator.vendor,\n      subString: 'KDE',\n      identity: 'Konqueror',\n    }, {\n      string: navigator.userAgent,\n      subString: 'Firefox',\n      identity: 'Firefox',\n    }, {\n      string: navigator.vendor,\n      subString: 'Camino',\n      identity: 'Camino',\n    }, { // for newer Netscapes (6+)\n      string: navigator.userAgent,\n      subString: 'Netscape',\n      identity: 'Netscape',\n    }, {\n      string: navigator.userAgent,\n      subString: 'MSIE',\n      identity: 'Explorer',\n      versionSearch: 'MSIE',\n    }, {\n      string: navigator.userAgent,\n      subString: 'Gecko',\n      identity: 'Mozilla',\n      versionSearch: 'rv',\n    }, { // for older Netscapes (4-)\n      string: navigator.userAgent,\n      subString: 'Mozilla',\n      identity: 'Netscape',\n      versionSearch: 'Mozilla',\n    }],\n    dataOS: [{\n      string: navigator.platform,\n      subString: 'Win',\n      identity: 'Windows',\n    }, {\n      string: navigator.platform,\n      subString: 'Mac',\n      identity: 'Mac OS',\n    }, {\n      string: navigator.userAgent,\n      subString: 'iPhone',\n      identity: 'iOS',\n    }, {\n      string: navigator.platform,\n      subString: 'Linux',\n      identity: 'Linux',\n    }],\n\n  };\n  BrowserDetect.init();\n}).call(this);\n"]}