!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.leanplum=b():a.leanplum=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=3)}([function(a,b,c){"use strict";a.exports={METHODS:{START:"start",STOP:"stop",ADVANCE:"advance",TRACK:"track",PAUSE_SESSION:"pauseSession",RESUME_SESSION:"resumeSession",PAUSE_STATE:"pauseState",RESUME_STATE:"resumeState",DOWNLOAD_FILE:"downloadFile",MULTI:"multi",SET_VARS:"setVars",GET_VARS:"getVars",SET_USER_ATTRIBUTES:"setUserAttributes",UPLOAD_FILE:"uploadFile",REGISTER_DEVICE:"registerDevice"},SDK_VERSION:"1.1.10",CLIENT:"js",PARAMS:{ACTION:"action",APP_ID:"appId",CLIENT:"client",CLIENT_KEY:"clientKey",DEVICE_ID:"deviceId",SDK_VERSION:"sdkVersion",USER_ID:"userId",NEW_USER_ID:"newUserId",DEV_MODE:"devMode",VERSION_NAME:"versionName",SYSTEM_NAME:"systemName",SYSTEM_VERSION:"systemVersion",BROWSER_NAME:"browserName",BROWSER_VERSION:"browserVersion",DEVICE_NAME:"deviceName",DEVICE_MODEL:"deviceModel",USER_ATTRIBUTES:"userAttributes",LOCALE:"locale",COUNTRY:"country",REGION:"region",CITY:"city",LOCATION:"location",STATE:"state",INFO:"info",EVENT:"event",VALUE:"value",FILENAME:"filename",TIME:"time",DATA:"data",VARS:"vars",FILE:"file",SIZE:"size",VARIATION:"variation",HASH:"hash",EMAIL:"email",VARIABLES:"vars",PARAMS:"params",INCLUDE_DEFAULTS:"includeDefaults"},KEYS:{IS_REGISTERED:"isRegistered",LATEST_VERSION:"latestVersion",VARS:"vars",VARIANTS:"variants",ACTION_METADATA:"actionMetadata",TOKEN:"token"},DEFAULT_KEYS:{COUNT:"__leanplum_unsynced",ITEM:"__leanplum_unsynced_",VARIABLES:"__leanplum_variables",VARIANTS:"__leanplum_variants",ACTION_METADATA:"__leanplum_action_metadata",TOKEN:"__leanplum_token",DEVICE_ID:"__leanplum_device_id",USER_ID:"__leanplum_user_id"},VALUES:{DETECT:"(detect)"}}},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=c(0),g=function(a){return a&&a.__esModule?a:{default:a}}(f),h=function(){function a(){d(this,a),this.argString="",this.argValues={}}return e(a,[{key:"add",value:function(a,b){return void 0===b?this:(this.argString&&(this.argString+="&"),this.argString+=a+"="+encodeURIComponent(b),this.argValues[a]=b,this)}},{key:"body",value:function(a){return a?(this._body=a,this):this._body}},{key:"attachApiKeys",value:function(a,b){return this.add(g.default.PARAMS.APP_ID,a).add(g.default.PARAMS.CLIENT,g.default.CLIENT).add(g.default.PARAMS.CLIENT_KEY,b)}},{key:"build",value:function(){return this.argString}},{key:"buildDict",value:function(){return this.argValues}}]),a}();a.exports=h},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],g=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac OS"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],h=function(){function a(){d(this,a),this.browser=this.searchString(f)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(g)||"an unknown OS"}return e(a,[{key:"searchString",value:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!=c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}}},{key:"searchVersion",value:function(a){if(a){var b=a.indexOf(this.versionSearchString);if(-1!=b)return parseFloat(a.substring(b+this.versionSearchString.length+1))}}}]),a}();a.exports=h},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(0),i=d(h),j=c(1),k=d(j),l=c(2),m=d(l),n=[],o=[],p=[],q=[],r={},s="",t=!0,u=5,v="https://www.leanplum.com/api",w="dev.leanplum.com",x=10,y=void 0,z={},A=new m.default,B=function(){function a(){e(this,a)}return g(a,null,[{key:"setApiPath",value:function(a){a&&!a.isEmpty()&&(v=a)}},{key:"setEmail",value:function(b){a._email=b}},{key:"setNetworkTimeout",value:function(a){x=a}},{key:"setAppIdForDevelopmentMode",value:function(b,c){a._appId=b,a._clientKey=c,a._devMode=!0}},{key:"setAppIdForProductionMode",value:function(b,c){a._appId=b,a._clientKey=c,a._devMode=!1}},{key:"setSocketHost",value:function(a){w=a}},{key:"setDeviceId",value:function(b){a._deviceId=b}},{key:"setAppVersion",value:function(b){a._versionName=b}},{key:"setDeviceName",value:function(b){a._deviceName=b}},{key:"setDeviceModel",value:function(b){a._deviceModel=b}},{key:"setSystemName",value:function(b){a._systemName=b}},{key:"setSystemVersion",value:function(b){a._systemVersion=b}},{key:"setVariables",value:function(b){a._variables=b}},{key:"setRequestBatching",value:function(a,b){t=a,u=b}},{key:"getVariables",value:function(b){return void 0!==a._merged?a._merged:a._variables}},{key:"getVariable",value:function(a){for(var c=b.getVariables(),d=0;d<arguments.length;d++)c=c[arguments.i];return c}},{key:"getVariants",value:function(){return p||[]}},{key:"addStartResponseHandler",value:function(b){q.push(b),a._hasStarted&&b(a._startSuccessful)}},{key:"addVariablesChangedHandler",value:function(b){o.push(b),a._hasReceivedDiffs&&b()}},{key:"removeStartResponseHandler",value:function(a){var b=q.indexOf(a);b>=0&&q.splice(b,1)}},{key:"removeVariablesChangedHandler",value:function(a){var b=o.indexOf(a);b>=0&&o.splice(b,1)}},{key:"start",value:function(c,d,e){"function"==typeof c?(e=c,d={},c=null):"object"==(void 0===c?"undefined":f(c))&&null!==c&&void 0!==c?(e=d,d=c,c=null):"function"==typeof d&&(e=d,d={}),a._userId=c,e&&b.addStartResponseHandler(e),a._request(i.default.METHODS.START,(new k.default).add(i.default.PARAMS.USER_ATTRIBUTES,JSON.stringify(d)).add(i.default.PARAMS.COUNTRY,i.default.VALUES.DETECT).add(i.default.PARAMS.REGION,i.default.VALUES.DETECT).add(i.default.PARAMS.CITY,i.default.VALUES.DETECT).add(i.default.PARAMS.LOCATION,i.default.VALUES.DETECT).add(i.default.PARAMS.SYSTEM_NAME,a._systemName||A.OS).add(i.default.PARAMS.SYSTEM_VERSION,""+(a._systemVersion||"")).add(i.default.PARAMS.BROWSER_NAME,A.browser).add(i.default.PARAMS.BROWSER_VERSION,""+A.version).add(i.default.PARAMS.LOCALE,i.default.VALUES.DETECT).add(i.default.PARAMS.DEVICE_NAME,a._deviceName||A.browser+" "+A.version).add(i.default.PARAMS.DEVICE_MODEL,a._deviceModel||"Web Browser").add(i.default.PARAMS.INCLUDE_DEFAULTS,!1),{queued:!0,sendNow:!0,response:function(b){a._hasStarted=!0;var c=a._getLastResponse(b);if(a._isResponseSuccess(c)){if(a._startSuccessful=!0,a._devMode){var d=c[i.default.KEYS.LATEST_VERSION];d&&console.log("A newer version of Leanplum, "+d+", is available. Go to leanplum.com to download it."),WebSocket?a._socketIOConnect():console.log("Your browser doesn't support WebSockets.")}a.setContent(c[i.default.KEYS.VARS],c[i.default.KEYS.VARIANTS],c[i.default.KEYS.ACTION_METADATA]),s=c[i.default.KEYS.TOKEN]}else a._startSuccessful=!1,a._loadDiffs();for(var e=0;e<q.length;e++)q[e](a._startSuccessful)}})}},{key:"startFromCache",value:function(c,d,e){"function"==typeof c?(e=c,d={},c=null):"object"==(void 0===c?"undefined":f(c))&&null!==c&&void 0!==c?(e=d,d=c,c=null):"function"==typeof d&&(e=d,d={}),a._userId=c,e&&b.addStartResponseHandler(e),a._hasStarted=!0,a._startSuccessful=!0,a._devMode&&(WebSocket?a._socketIOConnect():console.log("Your browser doesn't support WebSockets.")),a._loadDiffs();for(var g=0;g<q.length;g++)q[g](a._startSuccessful)}},{key:"stop",value:function(){a._request(i.default.METHODS.STOP,void 0,{sendNow:!0,queued:!0})}},{key:"pauseSession",value:function(){a._request(i.default.METHODS.PAUSE_SESSION,void 0,{sendNow:!0,queued:!0})}},{key:"resumeSession",value:function(){a._request(i.default.METHODS.RESUME_SESSION,void 0,{sendNow:!0,queued:!0})}},{key:"pauseState",value:function(){a._request(i.default.METHODS.PAUSE_STATE,void 0,{queued:!0})}},{key:"resumeState",value:function(){a._request(i.default.METHODS.RESUME_STATE,void 0,{queued:!0})}},{key:"setUserId",value:function(a){b.setUserAttributes(a)}},{key:"setUserAttributes",value:function(b,c){if(void 0===c)if("object"==(void 0===b?"undefined":f(b)))c=b,b=void 0;else if("string"!=typeof b)return void console.log("Leanplum: setUserAttributes expects a string or an object");a._request(i.default.METHODS.SET_USER_ATTRIBUTES,(new k.default).add(i.default.PARAMS.USER_ATTRIBUTES,c?JSON.stringify(c):void 0).add(i.default.PARAMS.NEW_USER_ID,b),{queued:!0}),b&&(a._userId=b,a._saveToLocalStorage(i.default.DEFAULT_KEYS.USER_ID,a._userId))}},{key:"track",value:function(b,c,d,e){"object"==(void 0===c?"undefined":f(c))&&null!==c&&void 0!==c?(e=c,d=void 0,c=void 0):"string"==typeof c?(e=d,d=c,c=void 0):"object"==(void 0===d?"undefined":f(d))&&null!==d&&void 0!==d&&(e=d,d=void 0),a._request(i.default.METHODS.TRACK,(new k.default).add(i.default.PARAMS.EVENT,b).add(i.default.PARAMS.VALUE,c||0).add(i.default.PARAMS.INFO,d).add(i.default.PARAMS.PARAMS,JSON.stringify(e)),{queued:!0})}},{key:"advanceTo",value:function(b,c,d){"object"==(void 0===c?"undefined":f(c))&&null!==c&&void 0!==c&&(d=c,c=void 0),a._request(i.default.METHODS.ADVANCE,(new k.default).add(i.default.PARAMS.STATE,b).add(i.default.PARAMS.INFO,c).add(i.default.PARAMS.PARAMS,JSON.stringify(d)),{queued:!0})}},{key:"_socketIOConnect",value:function(){var b=new SocketIOClient,c=!1;b.onopen=function(){if(!c){console.log("Leanplum: Connected to development server.");var d={};d[i.default.PARAMS.APP_ID]=a._appId,d[i.default.PARAMS.DEVICE_ID]=a._deviceId,b.emit("auth",d),c=!0}},b.onerror=function(a){console.log("Leanplum: Socket error",a)},b.onmessage=function(c,d){"updateVars"==c?a._request(i.default.METHODS.GET_VARS,(new k.default).add(i.default.PARAMS.INCLUDE_DEFAULTS,!1),{queued:!1,sendNow:!0,response:function(b){var c=a._getLastResponse(b),d=c[i.default.KEYS.VARS],e=c[i.default.KEYS.VARIANTS],f=c[i.default.KEYS.ACTION_METADATA];_.isEqual(d,a._diffs)||a.setContent(d,e,f)}}):"getVariables"==c?(a.sendVariables(),b.emit("getContentResponse",{updated:!0})):"getActions"==c?b.emit("getContentResponse",{updated:!1}):"registerDevice"==c&&alert("Your device has been registered to "+d[0].email+".")},b.onclose=function(){console.log("Leanplum: Disconnected to development server."),c=!1},b.connect(),setInterval(function(){b.connected||b.connecting||b.connect()},5e3)}},{key:"_setContent",value:function(b,c,d){a._diffs=b,p=c,r=d,a._hasReceivedDiffs=!0,a._merged=a.mergeHelper(a._variables,b),a.saveDiffs();for(var e=0;e<o.length;e++)o[e]()}},{key:"_mergeHelper",value:function(b,c){if("number"==typeof c||"boolean"==typeof c||"string"==typeof c)return c;if(null===c||void 0===c)return b;var d=function(a){return function(b){if(a instanceof Array)for(var c=0;c<a.length;c++)b(a[c]);else for(var d in a)({}).hasOwnProperty.call(a,d)&&b(d)}},e=d(b),f=d(c),g=!1;if(null==b&&!(c instanceof Array)){g=null;for(var h in c){if(null===g&&(g=!0),"string"!=typeof h){g=!1;break}if(h.length<3||"["!=h.charAt(0)||"]"!=h.charAt(h.length-1)){g=!1;break}var i=h.substring(1,h.length-1);if(!(""+parseInt(i))==i){g=!1;break}}}if(b instanceof Array||g){var j=[];return e(function(a){j.push(a)}),f(function(b){for(var d=parseInt(b.substring(1,b.length-1)),e=c[b];d>=j.length;)j.push(null);j[d]=a.mergeHelper(j[d],e)}),j}var k={};return e(function(a){null!==c[a]&&void 0!==c[a]||(k[a]=b[a])}),f(function(d){k[d]=a.mergeHelper(null!=b?b[d]:null,c[d])}),k}},{key:"_sendVariables",value:function(){var b={};b[i.default.PARAMS.VARIABLES]=a._variables,a._request(i.default.METHODS.SET_VARS,(new k.default).body(JSON.stringify(b)),{sendNow:!0})}},{key:"_loadDiffs",value:function(){try{a.setContent(JSON.parse(a._getFromLocalStorage(i.default.DEFAULT_KEYS.VARIABLES)||null),JSON.parse(a._getFromLocalStorage(i.default.DEFAULT_KEYS.VARIANTS)||null),JSON.parse(a._getFromLocalStorage(i.default.DEFAULT_KEYS.ACTION_METADATA)||null)),s=a._getFromLocalStorage(i.default.DEFAULT_KEYS.TOKEN)}catch(a){console.log("Leanplum: Invalid diffs: "+a)}}},{key:"_saveDiffs",value:function(){a._saveToLocalStorage(i.default.DEFAULT_KEYS.VARIABLES,JSON.stringify(a._diffs||{})),a._saveToLocalStorage(i.default.DEFAULT_KEYS.VARIANTS,JSON.stringify(p||[])),a._saveToLocalStorage(i.default.DEFAULT_KEYS.ACTION_METADATA,JSON.stringify(r||{})),a._saveToLocalStorage(i.default.DEFAULT_KEYS.TOKEN,s)}},{key:"_saveRequestForLater",value:function(b){var c=a._getFromLocalStorage(i.default.DEFAULT_KEYS.COUNT)||0,d=i.default.DEFAULT_KEYS.ITEM+c;a._saveToLocalStorage(d,JSON.stringify(b)),c++,a._saveToLocalStorage(i.default.DEFAULT_KEYS.COUNT,c)}},{key:"_popUnsentRequests",value:function(){var b=[],c=a._getFromLocalStorage(i.default.DEFAULT_KEYS.COUNT)||0;a._removeFromLocalStorage(i.default.DEFAULT_KEYS.COUNT);for(var d=0;d<c;d++){var e=i.default.DEFAULT_KEYS.ITEM+d;try{var f=JSON.parse(a._getFromLocalStorage(e));b.push(f)}catch(a){}a._removeFromLocalStorage(e)}return b}},{key:"_request",value:function(b,c,d){if(d=d||{},c=c||new k.default,a._deviceId||(a._deviceId=a._getFromLocalStorage(i.default.DEFAULT_KEYS.DEVICE_ID)),!a._deviceId){for(var e="",f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",g=0;g<16;g++)e+=f.charAt(Math.floor(Math.random()*f.length));a._deviceId=e,a._saveToLocalStorage(i.default.DEFAULT_KEYS.DEVICE_ID,e)}a._userId||(a._userId=a._getFromLocalStorage(i.default.DEFAULT_KEYS.USER_ID),a._userId||(a._userId=a._deviceId)),a._saveToLocalStorage(i.default.DEFAULT_KEYS.USER_ID,a._userId);var h=c.attachApiKeys(a._appId,a._clientKey).add(i.default.PARAMS.SDK_VERSION,i.default.SDK_VERSION).add(i.default.PARAMS.DEVICE_ID,a._deviceId).add(i.default.PARAMS.USER_ID,a._userId).add(i.default.PARAMS.ACTION,b).add(i.default.PARAMS.VERSION_NAME,a._versionName).add(i.default.PARAMS.DEV_MODE,a._devMode).add(i.default.PARAMS.TIME,""+(new Date).getTime()/1e3),j=d.success||d.response,l=d.error||d.response;if(!a._appId||!a._clientKey){var m="Leanplum App ID and client key are not set. Make sure you are calling setAppIdForDevelopmentMode or setAppIdForProductionMode before issuing API calls.";return console.error(m),void(l&&l(m))}if(c.body())return void a._ajax("POST",v+"?"+h.build(),c.body(),j,l,d.queued);var n=a._devMode||d.sendNow||!t,o=function(){var b=a._popUnsentRequests();if(b.length>0){var c=JSON.stringify({data:b}),e=(new k.default).attachApiKeys(a._appId,a._clientKey).add(i.default.PARAMS.SDK_VERSION,i.default.SDK_VERSION).add(i.default.PARAMS.ACTION,i.default.METHODS.MULTI).add(i.default.PARAMS.TIME,""+(new Date).getTime()/1e3).build();a._ajax("POST",v+"?"+e,c,j,l,d.queued)}};if(!n&&u){var p=(new Date).getTime()/1e3;!a._lastRequestTime||p-a._lastRequestTime>=u?(n=!0,a._lastRequestTime=p):a._cooldownTimeout||(a._cooldownTimeout=setTimeout(function(){a._cooldownTimeout=null,a._lastRequestTime=(new Date).getTime()/1e3,o()},1e3*(u-(p-a._lastRequestTime))))}a._saveRequestForLater(h.buildDict()),n&&o()}},{key:"_numResponses",value:function(a){return a&&a.response?a.response.length:0}},{key:"_getResponseAt",value:function(a,b){return a&&a.response?a.response[b]:null}},{key:"_getLastResponse",value:function(b){var c=a._numResponses(b);return c>0?a._getResponseAt(b,c-1):null}},{key:"_isResponseSuccess",value:function(a){return!!a&&!!a.success}},{key:"_getResponseError",value:function(a){if(!a)return null;var b=a.error;return b?b.message:null}},{key:"_getFromLocalStorage",value:function(a){return!1===y?z[a]:localStorage[a]}},{key:"_saveToLocalStorage",value:function(b,c){if(!1===y)return void(z[b]=c);try{localStorage[b]=c}catch(d){y=!1,a._saveToLocalStorage(b,c)}}},{key:"_removeFromLocalStorage",value:function(b){if(!1===y)return void delete z[b];try{localStorage.removeItem(b)}catch(c){y=!1,a._removeFromLocalStorage(b)}}},{key:"_ajaxIE8",value:function(b,c,d,e,f,g,h){var i=new XDomainRequest;i.onload=function(){var b=void 0,c=!1;if(h)b=i.responseText;else try{b=JSON.parse(i.responseText)}catch(a){setTimeout(function(){f&&f(null,i)},0),c=!0}c||setTimeout(function(){e&&e(b,i)},0),g&&(a._runningRequest=!1,a._dequeueRequest())},i.onerror=i.ontimeout=function(){setTimeout(function(){f&&f(null,i)},0),g&&(a._runningRequest=!1,a._dequeueRequest())},i.onprogress=function(){},i.open(b,c),i.timeout=1e3*x,i.send(d)}},{key:"_enqueueRequest",value:function(a){n.push(a)}},{key:"_dequeueRequest",value:function(){var b=n.shift();b&&a._ajax.apply(null,b)}},{key:"_ajax",value:function(b,c,d,e,f,g,h){if(g){if(a._runningRequest)return a._enqueueRequest(arguments);a._runningRequest=!0}if("undefined"!=typeof XDomainRequest)return"http:"===location.protocol&&0==c.indexOf("https:")&&(c="http:"+c.substring(6)),a._ajaxIE8.apply(null,arguments);var i=!1,j=new XMLHttpRequest;j.onreadystatechange=function(){if(4===j.readyState){if(i)return;i=!0;var b=void 0,c=!1;if(h)b=j.responseText;else try{b=JSON.parse(j.responseText)}catch(a){setTimeout(function(){f&&f(null,j)},0),c=!0}c||(j.status>=200&&j.status<300?setTimeout(function(){e&&e(b,j)},0):setTimeout(function(){f&&f(b,j)},0)),g&&(a._runningRequest=!1,a._dequeueRequest())}},j.open(b,c,!0),j.setRequestHeader("Content-Type","text/plain"),j.send(d),setTimeout(function(){i||j.abort()},1e3*x)}}]),a}();a.exports=B}])});