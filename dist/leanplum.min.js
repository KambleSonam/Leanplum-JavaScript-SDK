(function(){var a={},b=function(){};this.Leanplum||(this.Leanplum=a);var c="https://www.leanplum.com/api",d="dev.leanplum.com",e=10,f={START:"start",STOP:"stop",ADVANCE:"advance",TRACK:"track",PAUSE_SESSION:"pauseSession",RESUME_SESSION:"resumeSession",PAUSE_STATE:"pauseState",RESUME_STATE:"resumeState",DOWNLOAD_FILE:"downloadFile",MULTI:"multi",SET_VARS:"setVars",GET_VARS:"getVars",SET_USER_ATTRIBUTES:"setUserAttributes",UPLOAD_FILE:"uploadFile",REGISTER_DEVICE:"registerDevice"},g={ACTION:"action",APP_ID:"appId",CLIENT:"client",CLIENT_KEY:"clientKey",DEVICE_ID:"deviceId",SDK_VERSION:"sdkVersion",USER_ID:"userId",NEW_USER_ID:"newUserId",DEV_MODE:"devMode",VERSION_NAME:"versionName",SYSTEM_NAME:"systemName",SYSTEM_VERSION:"systemVersion",BROWSER_NAME:"browserName",BROWSER_VERSION:"browserVersion",DEVICE_NAME:"deviceName",DEVICE_MODEL:"deviceModel",USER_ATTRIBUTES:"userAttributes",LOCALE:"locale",COUNTRY:"country",REGION:"region",CITY:"city",LOCATION:"location",STATE:"state",INFO:"info",EVENT:"event",VALUE:"value",FILENAME:"filename",TIME:"time",DATA:"data",VARS:"vars",FILE:"file",SIZE:"size",VARIATION:"variation",HASH:"hash",EMAIL:"email",VARIABLES:"vars",PARAMS:"params",INCLUDE_DEFAULTS:"includeDefaults"},h={IS_REGISTERED:"isRegistered",LATEST_VERSION:"latestVersion",VARS:"vars",VARIANTS:"variants",ACTION_METADATA:"actionMetadata",TOKEN:"token"},i={COUNT:"__leanplum_unsynced",ITEM:"__leanplum_unsynced_",VARIABLES:"__leanplum_variables",VARIANTS:"__leanplum_variants",ACTION_METADATA:"__leanplum_action_metadata",TOKEN:"__leanplum_token",DEVICE_ID:"__leanplum_device_id",USER_ID:"__leanplum_user_id"},j={DETECT:"(detect)"},k={_checkForUpdatesInDevelopmentMode:!0,_requestQueue:[],_variablesChangedHandlers:[],_variants:[],_startHandlers:[],_actionMetadata:{},_token:"",_batchEnabled:!0,_batchCooldown:5};a.setApiPath=function(a){c=a},a.setEmail=function(a){k._email=a},a.setUpdateCheckingEnabledInDevelopmentMode=function(a){k._checkForUpdatesInDevelopmentMode=a},a.setNetworkTimeout=function(a){e=a},a.setAppIdForDevelopmentMode=function(a,b){k._appId=a,k._clientKey=b,k._devMode=!0},a.setAppIdForProductionMode=function(a,b){k._appId=a,k._clientKey=b,k._devMode=!1},a.setSocketHost=function(a){d=a},a.setDeviceId=function(a){k._deviceId=a},a.setAppVersion=function(a){k._versionName=a},a.setDeviceName=function(a){k._deviceName=a},a.setDeviceModel=function(a){k._deviceModel=a},a.setSystemName=function(a){k._systemName=a},a.setSystemVersion=function(a){k._systemVersion=a},a.setVariables=function(a){k._variables=a},a.setRequestBatching=function(a,b){k._batchEnabled=a,k._batchCooldown=b},a.getVariables=function(a){return void 0!==k._merged?k._merged:k._variables},a.getVariable=function(b){for(var c=a.getVariables(),d=0;d<arguments.length;d++)c=c[arguments[d]];return c},a.getVariants=function(){return k._variants||[]},a.addStartResponseHandler=function(a){k._startHandlers.push(a),k._hasStarted&&a(k._startSuccessful)},a.addVariablesChangedHandler=function(a){k._variablesChangedHandlers.push(a),k._hasReceivedDiffs&&a()},a.removeStartResponseHandler=function(a){var b=k._startHandlers.indexOf(a);b>=0&&k._startHandlers.splice(b,1)},a.removeVariablesChangedHandler=function(a){var b=k._variablesChangedHandlers.indexOf(a);b>=0&&k._variablesChangedHandlers.splice(b,1)},a.start=function(b,c,d){"function"==typeof b?(d=b,c={},b=null):"object"==typeof b&&null!==b&&void 0!==b?(d=c,c=b,b=null):"function"==typeof c&&(d=c,c={}),k._userId=b,d&&a.addStartResponseHandler(d),k.request(f.START,(new l).add(g.USER_ATTRIBUTES,JSON.stringify(c)).add(g.COUNTRY,j.DETECT).add(g.REGION,j.DETECT).add(g.CITY,j.DETECT).add(g.LOCATION,j.DETECT).add(g.SYSTEM_NAME,k._systemName||o.OS).add(g.SYSTEM_VERSION,""+(k._systemVersion||"")).add(g.BROWSER_NAME,o.browser).add(g.BROWSER_VERSION,""+o.version).add(g.LOCALE,j.DETECT).add(g.DEVICE_NAME,k._deviceName||o.browser+" "+o.version).add(g.DEVICE_MODEL,k._deviceModel||"Web Browser").add(g.INCLUDE_DEFAULTS,!1),{queued:!0,sendNow:!0,response:function(a){k._hasStarted=!0;var b=k._getLastResponse(a);if(k._isResponseSuccess(b)){if(k._startSuccessful=!0,k._devMode){var c=b[h.LATEST_VERSION];c&&console.log("A newer version of Leanplum, "+c+", is available. Go to leanplum.com to download it."),WebSocket?k._socketIOConnect():console.log("Your browser doesn't support WebSockets.")}k.setContent(b[h.VARS],b[h.VARIANTS],b[h.ACTION_METADATA]),k._token=b[h.TOKEN]}else k._startSuccessful=!1,k.loadDiffs();for(var d=0;d<k._startHandlers.length;d++)k._startHandlers[d](k._startSuccessful)}})},a.startFromCache=function(b,c,d){"function"==typeof b?(d=b,c={},b=null):"object"==typeof b&&null!==b&&void 0!==b?(d=c,c=b,b=null):"function"==typeof c&&(d=c,c={}),k._userId=b,d&&a.addStartResponseHandler(d),k._hasStarted=!0,k._startSuccessful=!0,k._devMode&&(WebSocket?k._socketIOConnect():console.log("Your browser doesn't support WebSockets.")),k.loadDiffs();for(var e=0;e<k._startHandlers.length;e++)k._startHandlers[e](k._startSuccessful)},k._socketIOConnect=function(){var a=new m,c=!1;a.onopen=function(){if(!c){console.log("Leanplum: Connected to development server.");var b={};b[g.APP_ID]=k._appId,b[g.DEVICE_ID]=k._deviceId,a.emit("auth",b),c=!0}},a.onerror=function(a){console.log("Leanplum: Socket error",a)},a.onmessage=function(c,d){"updateVars"==c?k.request(f.GET_VARS,(new l).add(g.INCLUDE_DEFAULTS,!1),{queued:!1,sendNow:!0,response:function(a){var c=k._getLastResponse(a),d=c[h.VARS],e=c[h.VARIANTS],f=c[h.ACTION_METADATA];b.isEqual(d,k._diffs)||k.setContent(d,e,f)}}):"getVariables"==c?(k.sendVariables(),a.emit("getContentResponse",{updated:!0})):"getActions"==c?a.emit("getContentResponse",{updated:!1}):"registerDevice"==c&&alert("Your device has been registered to "+d[0].email+".")},a.onclose=function(){console.log("Leanplum: Disconnected to development server."),c=!1},a.connect(),setInterval(function(){a.connected||a.connecting||a.connect()},5e3)},a.stop=function(){k.request(f.STOP,void 0,{sendNow:!0,queued:!0})},a.pauseSession=function(){k.request(f.PAUSE_SESSION,void 0,{sendNow:!0,queued:!0})},a.resumeSession=function(){k.request(f.RESUME_SESSION,void 0,{sendNow:!0,queued:!0})},a.pauseState=function(){k.request(f.PAUSE_STATE,void 0,{queued:!0})},a.resumeState=function(){k.request(f.RESUME_STATE,void 0,{queued:!0})},a.setUserId=function(b){a.setUserAttributes(b)},a.setUserAttributes=function(a,b){if(void 0===b)if("object"==typeof a)b=a,a=void 0;else if("string"!=typeof a)return void console.log("Leanplum: setUserAttributes expects a string or an object");k.request(f.SET_USER_ATTRIBUTES,(new l).add(g.USER_ATTRIBUTES,b?JSON.stringify(b):void 0).add(g.NEW_USER_ID,a),{queued:!0}),a&&(k._userId=a,k._saveToLocalStorage(i.USER_ID,k._userId))},a.track=function(a,b,c,d){"object"==typeof b&&null!==b&&void 0!==b?(d=b,c=void 0,b=void 0):"string"==typeof b?(d=c,c=b,b=void 0):"object"==typeof c&&null!==c&&void 0!==c&&(d=c,c=void 0),k.request(f.TRACK,(new l).add(g.EVENT,a).add(g.VALUE,b||0).add(g.INFO,c).add(g.PARAMS,JSON.stringify(d)),{queued:!0})},a.advanceTo=function(a,b,c){"object"==typeof b&&null!==b&&void 0!==b&&(c=b,b=void 0),k.request(f.ADVANCE,(new l).add(g.STATE,a).add(g.INFO,b).add(g.PARAMS,JSON.stringify(c)),{queued:!0})},k.setContent=function(a,b,c){k._diffs=a,k._variants=b,k._actionMetadata=c,k._hasReceivedDiffs=!0,k._merged=k.mergeHelper(k._variables,a),k.saveDiffs();for(var d=0;d<k._variablesChangedHandlers.length;d++)k._variablesChangedHandlers[d]()},k.mergeHelper=function(a,b){if("number"==typeof b||"boolean"==typeof b||"string"==typeof b)return b;if(null===b||void 0===b)return a;var c=function(a){return function(b){if(a instanceof Array)for(var c=0;c<a.length;c++)b(a[c]);else for(var d in a)b(d)}},d=c(a),e=c(b),f=!1;if(null==a&&!(b instanceof Array)){f=null;for(var g in b){if(null===f&&(f=!0),"string"!=typeof g){f=!1;break}if(g.length<3||"["!=g.charAt(0)||"]"!=g.charAt(g.length-1)){f=!1;break}var h=g.substring(1,g.length-1);if(!(""+parseInt(h))==h){f=!1;break}}}if(a instanceof Array||f){var i=[];return d(function(a){i.push(a)}),e(function(a){for(var c=parseInt(a.substring(1,a.length-1)),d=b[a];c>=i.length;)i.push(null);i[c]=k.mergeHelper(i[c],d)}),i}var i={};return d(function(c){null!==b[c]&&void 0!==b[c]||(i[c]=a[c])}),e(function(c){i[c]=k.mergeHelper(null!=a?a[c]:null,b[c])}),i},k.sendVariables=function(){var a={};a[g.VARIABLES]=k._variables,k.request(f.SET_VARS,(new l).body(JSON.stringify(a)),{sendNow:!0})},k.loadDiffs=function(){try{k.setContent(JSON.parse(k._getFromLocalStorage(i.VARIABLES)||null),JSON.parse(k._getFromLocalStorage(i.VARIANTS)||null),JSON.parse(k._getFromLocalStorage(i.ACTION_METADATA))||null),k._token=k._getFromLocalStorage(i.TOKEN)}catch(a){console.log("Leanplum: Invalid diffs: "+a)}},k.saveDiffs=function(){k._saveToLocalStorage(i.VARIABLES,JSON.stringify(k._diffs||{})),k._saveToLocalStorage(i.VARIANTS,JSON.stringify(k._variants||[])),k._saveToLocalStorage(i.ACTION_METADATA,JSON.stringify(k._actionMetadata||{})),k._saveToLocalStorage(i.TOKEN,k._token)},k._saveRequestForLater=function(a){var b=k._getFromLocalStorage(i.COUNT)||0,c=i.ITEM+b;k._saveToLocalStorage(c,JSON.stringify(a)),b++,k._saveToLocalStorage(i.COUNT,b)},k._popUnsentRequests=function(){var a=[],b=k._getFromLocalStorage(i.COUNT)||0;k._removeFromLocalStorage(i.COUNT);for(var c=0;c<b;c++){var d=i.ITEM+c;try{var e=JSON.parse(k._getFromLocalStorage(d));a.push(e)}catch(a){}k._removeFromLocalStorage(d)}return a},k.request=function(a,b,d){if(d=d||{},b=b||new l,k._deviceId||(k._deviceId=k._getFromLocalStorage(i.DEVICE_ID)),!k._deviceId){for(var e="",h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",j=0;j<16;j++)e+=h.charAt(Math.floor(Math.random()*h.length));k._deviceId=e,k._saveToLocalStorage(i.DEVICE_ID,e)}k._userId||(k._userId=k._getFromLocalStorage(i.USER_ID),k._userId||(k._userId=k._deviceId)),k._saveToLocalStorage(i.USER_ID,k._userId);var m=b.attachApiKeys().add(g.SDK_VERSION,"1.1.10").add(g.DEVICE_ID,k._deviceId).add(g.USER_ID,k._userId).add(g.ACTION,a).add(g.VERSION_NAME,k._versionName).add(g.DEV_MODE,k._devMode).add(g.TIME,""+(new Date).getTime()/1e3),n=d.success||d.response,o=d.error||d.response;if(!k._appId||!k._clientKey){var p="Leanplum App ID and client key are not set. Make sure you are calling setAppIdForDevelopmentMode or setAppIdForProductionMode before issuing API calls.";return console.error(p),void(o&&o(p))}if(b.body())return void k._ajax("POST",c+"?"+m.build(),b.body(),n,o,d.queued);var q=k._devMode||d.sendNow||!k._batchEnabled,r=function(){var a=k._popUnsentRequests();if(a.length>0){var b=JSON.stringify({data:a}),e=(new l).attachApiKeys().add(g.SDK_VERSION,"1.1.10").add(g.ACTION,f.MULTI).add(g.TIME,""+(new Date).getTime()/1e3).build();k._ajax("POST",c+"?"+e,b,n,o,d.queued)}};if(!q&&k._batchCooldown){var s=(new Date).getTime()/1e3;!k._lastRequestTime||s-k._lastRequestTime>=k._batchCooldown?(q=!0,k._lastRequestTime=s):k._cooldownTimeout||(k._cooldownTimeout=setTimeout(function(){k._cooldownTimeout=null,k._lastRequestTime=(new Date).getTime()/1e3,r()},1e3*(k._batchCooldown-(s-k._lastRequestTime))))}k._saveRequestForLater(m.buildDict()),q&&r()},k._numResponses=function(a){return a&&a.response?a.response.length:0},k._getResponseAt=function(a,b){return a&&a.response?a.response[b]:null},k._getLastResponse=function(a){var b=k._numResponses(a);return b>0?k._getResponseAt(a,b-1):null},k._isResponseSuccess=function(a){return!!a&&!!a.success},k._getResponseError=function(a){if(!a)return null;var b=a.error;return b?b.message:null},k._localStorageEnabled=void 0,k._alternateLocalStorage={},k._getFromLocalStorage=function(a){return!1===k._localStorageEnabled?k._alternateLocalStorage[a]:localStorage[a]},k._saveToLocalStorage=function(a,b){if(!1===k._localStorageEnabled)return void(k._alternateLocalStorage[a]=b);try{localStorage[a]=b}catch(c){k._localStorageEnabled=!1,k._saveToLocalStorage(a,b)}},k._removeFromLocalStorage=function(a){if(!1===k._localStorageEnabled)return void delete k._alternateLocalStorage[a];try{localStorage.removeItem(a)}catch(b){k._localStorageEnabled=!1,k._removeFromLocalStorage(a)}};var l=function(){this.argString="",this.argValues={}};l.prototype.add=function(a,b){return void 0===b?this:(this.argString&&(this.argString+="&"),this.argString+=a+"="+encodeURIComponent(b),this.argValues[a]=b,this)},l.prototype.body=function(a){return a?(this._body=a,this):this._body},l.prototype.attachApiKeys=function(a){return this.add(g.APP_ID,k._appId).add(g.CLIENT,"js").add(g.CLIENT_KEY,k._clientKey)},l.prototype.build=function(){return this.argString},l.prototype.buildDict=function(){return this.argValues};var m=function(){this.connected=!1,this.connecting=!1};m.prototype.emit=function(a,b){this.socket.send("5:::"+JSON.stringify({name:a,args:b}))},m.prototype.connect=function(){var a=this;a.connecting=!0,k._ajax("POST","https://"+d+"/socket.io/1","",function(b){var c=b.split(":"),e=c[0],f=parseInt(c[1])/2*1e3;a.socket=new WebSocket("wss://"+d+"/socket.io/1/websocket/"+e);var g=null;a.socket.onopen=function(){a.connected=!0,a.connecting=!1,a.onopen&&a.onopen(),g=setInterval(function(){a.socket.send("2:::")},f)},a.socket.onclose=function(){a.connected=!1,clearInterval(g),a.onclose&&a.onclose()},a.socket.onmessage=function(b){var c=b.data.split(":"),d=parseInt(c[0]);if(2==d)a.socket.send("2::");else if(5==d){var e=c[1],f=JSON.parse(c.slice(3).join(":")),b=f.name,g=f.args;e&&a.socket.send("6:::"+e),a.onmessage&&a.onmessage(b,g)}else 7==d&&console.log("Socket error: "+b.data)},a.socket.onerror=function(b){a.socket.close(),a.onerror&&a.onerror(b)}},null,!1,!0)},k._ajaxIE8=function(a,b,c,d,f,g,h){var i=new XDomainRequest;i.onload=function(){var a,b=!1;if(h)a=i.responseText;else try{a=JSON.parse(i.responseText)}catch(a){setTimeout(function(){f&&f(null,i)},0),b=!0}b||setTimeout(function(){d&&d(a,i)},0),g&&(k._runningRequest=!1,k._dequeueRequest())},i.onerror=i.ontimeout=function(){setTimeout(function(){f&&f(null,i)},0),g&&(k._runningRequest=!1,k._dequeueRequest())},i.onprogress=function(){},i.open(a,b),i.timeout=1e3*e,i.send(c)},k._enqueueRequest=function(a){k._requestQueue.push(a)},k._dequeueRequest=function(){var a=k._requestQueue.shift();a&&k._ajax.apply(null,a)},k._ajax=function(a,b,c,d,f,g,h){if(g){if(k._runningRequest)return k._enqueueRequest(arguments);k._runningRequest=!0}if("undefined"!=typeof XDomainRequest)return"http:"===location.protocol&&0==b.indexOf("https:")&&(b="http:"+b.substring(6)),k._ajaxIE8.apply(null,arguments);var i=!1,j=new XMLHttpRequest;j.onreadystatechange=function(){if(4===j.readyState){if(i)return;i=!0;var a,b=!1;if(h)a=j.responseText;else try{a=JSON.parse(j.responseText)}catch(a){setTimeout(function(){f&&f(null,j)},0),b=!0}b||(j.status>=200&&j.status<300?setTimeout(function(){d&&d(a,j)},0):setTimeout(function(){f&&f(a,j)},0)),g&&(k._runningRequest=!1,k._dequeueRequest())}},j.open(a,b,!0),j.setRequestHeader("Content-Type","text/plain"),j.send(c),setTimeout(function(){i||j.abort()},1e3*e)},b.iextend=function(a){return each(slice.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a},b.isFunction=function(a){return"function"==typeof a},b.has=function(a,b){return hasOwnProperty.call(a,b)};var n=function(a,c,d,e){if(a===c)return 0!==a||1/a==1/c;if(null==a||null==c)return a===c;a instanceof b&&(a=a._wrapped),c instanceof b&&(c=c._wrapped);var f=Object.prototype.toString.call(a);if(f!=Object.prototype.toString.call(c))return!1;switch(f){case"[object String]":return a==String(c);case"[object Number]":return a!=+a?c!=+c:0==a?1/a==1/c:a==+c;case"[object Date]":case"[object Boolean]":return+a==+c;case"[object RegExp]":return a.source==c.source&&a.global==c.global&&a.multiline==c.multiline&&a.ignoreCase==c.ignoreCase}if("object"!=typeof a||"object"!=typeof c)return!1;for(var g=d.length;g--;)if(d[g]==a)return e[g]==c;d.push(a),e.push(c);var h=0,i=!0;if("[object Array]"==f){if(h=a.length,i=h==c.length)for(;h--&&(i=n(a[h],c[h],d,e)););}else{var j=a.constructor,k=c.constructor;if(j!==k&&!(b.isFunction(j)&&j instanceof j&&b.isFunction(k)&&k instanceof k))return!1;for(var l in a)if(b.has(a,l)&&(h++,!(i=b.has(c,l)&&n(a[l],c[l],d,e))))break;if(i){for(l in c)if(b.has(c,l)&&!h--)break;i=!h}}return d.pop(),e.pop(),i};b.isEqual=function(a,b){return n(a,b,[],[])};var o={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!=c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(-1!=b)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac OS"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};o.init()}).call(this);